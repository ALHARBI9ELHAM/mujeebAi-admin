<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة التحكم - مُجيب AI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="public/styles/style.css">
</head>
<body>

  <div class="sidebar">
    <h2>💼 مُجيب AI</h2>
    <a href="dashboard.html" class="active">📊 لوحة التحكم</a>
    <a href="clients.html">👥 إدارة العملاء</a>
    <a href="tickets.html">🎫 إدارة التذاكر</a>
    <a href="users.html">👤 إدارة المستخدمين</a>
    <a href="investor.html">💰 المستثمرين</a>
    <a href="index.html">🏠 العودة للواجهة الرئيسية</a>
  </div>

  <div class="main">
    <div class="header">
      <h2>لوحة التحكم</h2>
      <div id="userInfo">مرحبًا ...</div>
    </div>

    <div class="cards">
      <div class="card">
        <h5>عدد العملاء الكلي</h5>
        <h3 id="totalClients">0</h3>
      </div>
      <div class="card">
        <h5>العملاء الفعّالين</h5>
        <h3 id="activeClients">0</h3>
      </div>
      <div class="card">
        <h5>عدد التذاكر</h5>
        <h3 id="totalTickets">0</h3>
      </div>
      <div class="card">
        <h5>طلبات اليوم</h5>
        <h3 id="todayTickets">0</h3>
      </div>
    </div>

    <div class="charts">
      <canvas id="pieChart"></canvas>
      <canvas id="barChart"></canvas>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const loggedUser = JSON.parse(sessionStorage.getItem("loggedUser")) || { name: "غير معروف", role: "مستخدم" };
  document.getElementById("userInfo").textContent = `مرحبًا ${loggedUser.name} (${loggedUser.role})`;

  const clients = JSON.parse(localStorage.getItem("clients")) || [];
  const tickets = JSON.parse(localStorage.getItem("tickets")) || [];

  const totalClients = clients.length;
  const activeClients = clients.filter(c => c.active).length;
  const today = new Date().toISOString().split("T")[0];
  const todayTickets = tickets.filter(t => t.date === today).length;

  document.getElementById("totalClients").textContent = totalClients;
  document.getElementById("activeClients").textContent = activeClients;
  document.getElementById("totalTickets").textContent = tickets.length;
  document.getElementById("todayTickets").textContent = todayTickets;

  new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
      labels: ['فعّالين', 'غير فعّالين'],
      datasets: [{
        data: [activeClients, totalClients - activeClients],
        backgroundColor: ['#052e74', '#ccc']
      }]
    },
    options: {
      plugins: {
        title: { display: true, text: 'توزيع العملاء' },
        legend: { position: 'bottom' }
      }
    }
  });

  const weekLabels = ['الأحد','الاثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت'];
  const weekData = Array(7).fill(0);
  tickets.forEach(t => {
    const d = new Date(t.date);
    const day = d.getDay();
    weekData[day]++;
  });

  new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
      labels: weekLabels,
      datasets: [{
        label: 'عدد التذاكر',
        data: weekData,
        backgroundColor: '#052e74'
      }]
    },
    options: {
      plugins: {
        title: { display: true, text: 'التذاكر حسب الأيام' },
        legend: { display: false }
      },
      scales: { y: { beginAtZero: true } }
    }
  });
</script>

</body>
</html>
