<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ููุญุฉ ุงูุชุญูู - ููุฌูุจ AI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link rel="stylesheet" href="public/styles/style.css">
</head>
<body>

  <div class="sidebar">
    <h2>๐ผ ููุฌูุจ AI</h2>
    <a href="dashboard.html" class="active">๐ ููุญุฉ ุงูุชุญูู</a>
    <a href="clients.html">๐ฅ ุฅุฏุงุฑุฉ ุงูุนููุงุก</a>
    <a href="tickets.html">๐ซ ุฅุฏุงุฑุฉ ุงูุชุฐุงูุฑ</a>
    <a href="users.html">๐ค ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</a>
    <a href="investor.html">๐ฐ ุงููุณุชุซูุฑูู</a>
    <a href="index.html">๐ ุงูุนูุฏุฉ ูููุงุฌูุฉ ุงูุฑุฆูุณูุฉ</a>
  </div>

  <div class="main">
    <div class="header">
      <h2>ููุญุฉ ุงูุชุญูู</h2>
      <div id="userInfo">ูุฑุญุจูุง ...</div>
    </div>

    <div class="cards">
      <div class="card">
        <h5>ุนุฏุฏ ุงูุนููุงุก ุงูููู</h5>
        <h3 id="totalClients">0</h3>
      </div>
      <div class="card">
        <h5>ุงูุนููุงุก ุงููุนูุงููู</h5>
        <h3 id="activeClients">0</h3>
      </div>
      <div class="card">
        <h5>ุนุฏุฏ ุงูุชุฐุงูุฑ</h5>
        <h3 id="totalTickets">0</h3>
      </div>
      <div class="card">
        <h5>ุทูุจุงุช ุงูููู</h5>
        <h3 id="todayTickets">0</h3>
      </div>
    </div>

    <div class="charts">
      <canvas id="pieChart"></canvas>
      <canvas id="barChart"></canvas>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const loggedUser = JSON.parse(sessionStorage.getItem("loggedUser")) || { name: "ุบูุฑ ูุนุฑูู", role: "ูุณุชุฎุฏู" };
  document.getElementById("userInfo").textContent = `ูุฑุญุจูุง ${loggedUser.name} (${loggedUser.role})`;

  const clients = JSON.parse(localStorage.getItem("clients")) || [];
  const tickets = JSON.parse(localStorage.getItem("tickets")) || [];

  const totalClients = clients.length;
  const activeClients = clients.filter(c => c.active).length;
  const today = new Date().toISOString().split("T")[0];
  const todayTickets = tickets.filter(t => t.date === today).length;

  document.getElementById("totalClients").textContent = totalClients;
  document.getElementById("activeClients").textContent = activeClients;
  document.getElementById("totalTickets").textContent = tickets.length;
  document.getElementById("todayTickets").textContent = todayTickets;

  new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
      labels: ['ูุนูุงููู', 'ุบูุฑ ูุนูุงููู'],
      datasets: [{
        data: [activeClients, totalClients - activeClients],
        backgroundColor: ['#052e74', '#ccc']
      }]
    },
    options: {
      plugins: {
        title: { display: true, text: 'ุชูุฒูุน ุงูุนููุงุก' },
        legend: { position: 'bottom' }
      }
    }
  });

  const weekLabels = ['ุงูุฃุญุฏ','ุงูุงุซููู','ุงูุซูุงุซุงุก','ุงูุฃุฑุจุนุงุก','ุงูุฎููุณ','ุงูุฌูุนุฉ','ุงูุณุจุช'];
  const weekData = Array(7).fill(0);
  tickets.forEach(t => {
    const d = new Date(t.date);
    const day = d.getDay();
    weekData[day]++;
  });

  new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
      labels: weekLabels,
      datasets: [{
        label: 'ุนุฏุฏ ุงูุชุฐุงูุฑ',
        data: weekData,
        backgroundColor: '#052e74'
      }]
    },
    options: {
      plugins: {
        title: { display: true, text: 'ุงูุชุฐุงูุฑ ุญุณุจ ุงูุฃูุงู' },
        legend: { display: false }
      },
      scales: { y: { beginAtZero: true } }
    }
  });
</script>

</body>
</html>
