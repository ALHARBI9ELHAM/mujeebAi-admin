<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ°Ø§ÙƒØ± - Ù…ÙØ¬ÙŠØ¨ AI</title>
  <style>
    body {
      background-color: #f4f6fc;
      font-family: Tahoma, sans-serif;
      padding: 30px;
    }
    h2 {
      text-align: center;
      color: #052e74;
      margin-bottom: 30px;
    }
    .ticket {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-bottom: 15px;
    }
    .ticket strong {
      color: #052e74;
      font-size: 16px;
    }
    .ticket p {
      margin: 5px 0 0;
      color: #555;
    }
    .note {
      text-align: center;
      margin-top: 40px;
      color: #999;
      font-size: 14px;
    }
    .add-ticket {
      background-color: #052e74;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      display: block;
      margin: 20px auto;
    }
    select, input {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 15px;
    }
    .back-link {
      display: block;
      text-align: center;
      margin-top: 30px;
      text-decoration: none;
      font-weight: bold;
      color: #052e74;
    }
  </style>
</head>
<body>
  <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±</h2>

  <div id="ticketsList"></div>

  <h3>â• Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
  <select id="clientSelect"></select>
  <input type="text" id="ticketMessage" placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ°ÙƒØ±Ø©..." />
  <button class="add-ticket" onclick="addTicket()">Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒØ±Ø©</button>

  <a class="back-link" href="dashboard.html">â¬…ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>

  <div class="note" id="note"></div>

  <script>
    const clients = JSON.parse(localStorage.getItem("clients")) || [];
    const tickets = JSON.parse(localStorage.getItem("tickets")) || [];

    function renderClients() {
      const select = document.getElementById("clientSelect");
      select.innerHTML = "";
      if (clients.length === 0) {
        select.innerHTML = "<option>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</option>";
        select.disabled = true;
        document.getElementById("note").textContent = "ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØªØ°Ø§ÙƒØ± Ø¨Ø¯ÙˆÙ† Ø¹Ù…Ù„Ø§Ø¡.";
      } else {
        clients.forEach(client => {
          const option = document.createElement("option");
          option.value = client.id;
          option.textContent = client.name;
          select.appendChild(option);
        });
      }
    }

    function renderTickets() {
      const list = document.getElementById("ticketsList");
      list.innerHTML = "";
      if (tickets.length === 0) {
        list.innerHTML = "<div class='note'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ± Ø­Ø§Ù„ÙŠÙ‹Ø§</div>";
      } else {
        tickets.forEach(ticket => {
          const client = clients.find(c => c.id === ticket.clientId);
          const div = document.createElement("div");
          div.className = "ticket";
          div.innerHTML = `<strong>ğŸ“© Ù…Ù†: ${client ? client.name : "Ù…Ø¬Ù‡ÙˆÙ„"}</strong><p>"${ticket.message}"</p>`;
          list.appendChild(div);
        });
      }
    }

    function addTicket() {
      setTimeout(() => {
        const clientId = parseInt(document.getElementById("clientSelect").value);
        const messageInput = document.getElementById("ticketMessage");
        const message = messageInput.value.trim();

        if (!message || isNaN(clientId)) {
          alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„.");
          messageInput.focus();
          return;
        }

        const newTicket = {
          id: Date.now(),
          clientId: clientId,
          message: message
        };

        const tickets = JSON.parse(localStorage.getItem("tickets")) || [];
        tickets.push(newTicket);
        localStorage.setItem("tickets", JSON.stringify(tickets));

        messageInput.value = "";
        renderTickets();
      }, 50); // Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
    }

    renderClients();
    renderTickets();
  </script>
</body>
</html>
